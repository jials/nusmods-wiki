<section data-ng-controller="WikiController">
    <div class="nm-wrapper" ng-controller="ScrollController">

        <!-- sidebar -->
        <nav class="sidebar-wrapper navmenu-fixed-left" role="navigation" ng-controller="LeftBarCtrl">
            <div class="nav-wrapper">
                <ul class="nav" ng-repeat="link in links">
                    <li><a ng-class="{active: isActive(link.title)}" ng-click="gotoElement(link.title)">{{link.title | uppercase}}</a></li>
                </ul>
            </div>
        </nav>

        <div class="page-content-wrapper main-container" ng-controller="MainContentCtrl">
            <div class="loader-wrapper" ng-show="showSpinner"><rotating-plane-spinner ng-show="showSpinner"></rotating-plane-spinner></div>
            <div class="main-content container-fluid">

                <div class="row">
                    <div class="col-md-8">
                        <h1 class="module-code">{{module.ModuleCode}}</h1>
                        <h2 class="module-title">{{module.ModuleTitle}}</h2>
                        <div id="description" class="description-wrapper">
                            <div class="page-header"><h3>Description</h3></div>
                            {{module.ModuleDescription}}
                        </div>
                        
                        <div id="prerequisite" class="prerequisite-wrapper">
                            <div class="page-header"><h3>Prerequisite</h3></div>
                            {{module.Prerequisite}}
                            <span ng-if="module.Prerequisite == null">No prerequisite</span>
                        </div>

                        <div id="preclusion" class="preclusion-wrapper">
                            <div class="page-header"><h3>Preclusion</h3></div>
                            {{module.Preclusion}}
                            <span ng-if="module.Preclusion == null">No preclusion</span>
                        </div>

                        <div ng-controller="OtherContentCtrl">
                        {{content}}
                            <div id="past-lecturer" class="past-lecturer-wrapper">
                                <div class="page-header"><h3>Past Lecturer</h3></div>
                                <div ng-controller="PastLecturerCtrl" class="edit">
                                    <p ng-if="pastLecturer === '' && !authentication.user">Login in to add past lecturers!</p>
                                    <div ng-repeat="pastLecturer in pastLecturers">
                                        <div style="height:168px;margin-bottom:5px;">
                                            <div class="text-center" style="float:left;width:132px;height:168px;background-color:#D3D3D3;">
                                                <i class="fa fa-user big-icon" style="opacity:0.6;" ng-hide="pastLecturer.photo"></i>
                                                <img ng-if="pastLecturer.photo" ng-src="{{pastLecturer.photo}}/convert?w=132&h=168">
                                            </div>
                                            <div style="padding-left:-132px;width:100%;">
                                                <span style="margin-left:5px;">Name: {{pastLecturer.name}}</span><br>
                                                <span style="margin-left:5px;">AY: {{pastLecturer.academicYear1}}/{{pastLecturer.academicYear2}}</span>
                                            </div>
                                        </div>
                                    </div>

                                    <script type="text/ng-template" id="PastLecturerModalContent.html">
                                        <div class="modal-header">
                                            <h3 class="modal-title">Edit Past Lecturer</h3>
                                        </div>

                                        <div class="modal-body">
                                            <form novalidate name="PastLecturerForm">
                                            <div ng-repeat="pastLecturer in pastLecturers">
                                            <div class="form-group" show-errors>
                                                <label for="pastLecturer">Past Lecturer:</label><br>
                                                <input class="form-control" name="pastLecturer" type="text" ng-model="pastLecturer.name" required></input>
                                                <p class="help-block" ng-if="PastLecturerForm.pastLecturer.$error.required">Please enter lecturer name</p>
                                            </div>

                                            <div class="form-group" show-errors>
                                                <label for="academicYear">AY:</label><br>
                                                <div class="row">
                                                
                                                    <div class="col-xs-4">
                                                    <input class="form-control" placeholder="14" name="academicYear1" type="text" min="0" ng-model="pastLecturer.academicYear1" ng-pattern="/^[0-9]{2}$/" required></input>
                                                    </div>
                                                
                                                    <div class="col-xs-1" style="padding: 0;">
                                                        <p class="form-control-static text-center">/</p>
                                                    </div>
                                                
                                                    <div class="col-xs-4">
                                                    <input class="form-control" placeholder="15" name="academicYear2" type="text" min="0" ng-model="pastLecturer.academicYear2" ng-pattern="/^[0-9]{2}$/" required></input>
                                                    </div>

                                                </div> <!-- end of div.row -->
                                            </div>

                                            <div class="form-group">
                                                <button type="button" class="btn btn-primary sharp" ng-click="uploadFile($index)">Upload Image</button>
                                            </div>

                                            </div> <!-- ng-repeat -->

                                            <button class="btn btn-primary sharp" ng-click="add()">Add Lecturer</button>
                                            </form>
                                        </div>
                                        <div class="modal-footer">
                                            <button class="btn btn-primary sharp" ng-click="save()">Save</button>
                                            <button class="btn btn-warning sharp" ng-click="cancel()">Cancel</button>
                                        </div>
                                    </script>
                                    <br ng-show="authentication.user">
                                    <button class="btn btn-primary sharp" ng-click="open()" ng-show="authentication.user">Edit</button>
                                </div>
                            </div>

                            <div id="past-ta" class="past-ta-wrapper">
                                <div class="page-header"><h3>Past TA</h3></div>
                                <div ng-controller="PastTACtrl" class="edit">
                                    <p ng-if="pastLecturer === '' && !authentication.user">Login in to add past lecturers!</p>
                                    <div ng-repeat="pastTA in pastTAs">
                                        <div style="height:168px;margin-bottom:5px;">
                                            <div class="text-center" style="float:left;width:132px;height:168px;background-color:#D3D3D3;">
                                                <i class="fa fa-user big-icon" style="opacity:0.6;" ng-hide="pastTA.photo"></i>
                                                <img ng-if="pastTA.photo" ng-src="{{pastTA.photo}}/convert?w=132&h=168">
                                            </div>
                                            <div style="padding-left:-132px;width:100%;">
                                                <span style="margin-left:5px;">Name: {{pastTA.name}}</span><br>
                                                <span style="margin-left:5px;">AY: {{pastTA.academicYear1}}/{{pastTA.academicYear2}}</span>
                                            </div>
                                        </div>
                                    </div>

                                    <script type="text/ng-template" id="PastTAModalContent.html">
                                        <div class="modal-header">
                                            <h3 class="modal-title">Edit Past TA</h3>
                                        </div>

                                        <div class="modal-body">
                                            <form novalidate name="PastTAForm">
                                            <div ng-repeat="pastTA in pastTAs">
                                            <div class="form-group" show-errors>
                                                <label for="pastTA">Past Lecturer:</label><br>
                                                <input class="form-control" name="pastTA" type="text" ng-model="pastTA.name" required></input>
                                                <p class="help-block" ng-if="PastTAForm.pastTA.$error.required">Please enter lecturer name</p>
                                            </div>

                                            <div class="form-group" show-errors>
                                                <label for="academicYear">AY:</label><br>
                                                <div class="row">
                                                
                                                    <div class="col-xs-4">
                                                    <input class="form-control" placeholder="14" name="academicYear1" type="text" min="0" ng-model="pastTA.academicYear1" ng-pattern="/^[0-9]{2}$/" required></input>
                                                    </div>
                                                
                                                    <div class="col-xs-1" style="padding: 0;">
                                                        <p class="form-control-static text-center">/</p>
                                                    </div>
                                                
                                                    <div class="col-xs-4">
                                                    <input class="form-control" placeholder="15" name="academicYear2" type="text" min="0" ng-model="pastTA.academicYear2" ng-pattern="/^[0-9]{2}$/" required></input>
                                                    </div>

                                                </div> <!-- end of div.row -->
                                            </div>

                                            <div class="form-group">
                                                <button type="button" class="btn btn-primary sharp" ng-click="uploadFile($index)">Upload Image</button>
                                            </div>

                                            </div> <!-- ng-repeat -->

                                            <button class="btn btn-primary sharp" ng-click="add()">Add Lecturer</button>
                                            </form>
                                        </div>
                                        <div class="modal-footer">
                                            <button class="btn btn-primary sharp" ng-click="save()">Save</button>
                                            <button class="btn btn-warning sharp" ng-click="cancel()">Cancel</button>
                                        </div>
                                    </script>
                                    <br ng-show="authentication.user">
                                    <button class="btn btn-primary sharp" ng-click="open()" ng-show="authentication.user">Edit</button>
                                </div>
                            </div>

                            <div id="fun-facts" class="fun-facts-wrapper">
                                <div class="page-header"><h3>Fun Facts</h3></div>
                                <div ng-controller="FunFactsModalCtrl" class="edit">
                                    <p ng-if="content === '' && !authentication.user">Login and start editing!</p>
                                    <p>{{content}}</p>

                                    <script type="text/ng-template" id="FunFactsModalContent.html">
                                        <div class="modal-header">
                                            <h3 class="modal-title">Edit Fun Facts</h3>
                                        </div>
                                        <div class="modal-body">
                                            <form>
                                            <div class="form-group">
                                                <textarea class="form-control" ng-model="content" rows="4"></textarea>
                                            </div>
                                            </form>
                                        </div>
                                        <div class="modal-footer">
                                            <button class="btn btn-primary sharp" ng-click="save()">Save</button>
                                            <button class="btn btn-warning sharp" ng-click="cancel()">Cancel</button>
                                        </div>
                                    </script>
                                    <button class="btn btn-primary sharp" ng-click="open()" ng-show="authentication.user">Edit</button>
                                </div>
                            </div>

                            <div id="projects" class="projects-wrapper">
                                <div class="page-header"><h3>Outstanding Projects</h3></div>
                                <div ng-controller="ProjectsModalCtrl" class="edit">
                                    <div>
                                        <p ng-if="projects.length === 0 && !authentication.user">Login to add new projects!</p>
                                        <div ng-repeat="project in projects">
                                            <div class="page-header">{{project.name}} [AY:{{project.academicYear1}}/{{project.academicYear1}}]</div>
                                            <div style="float:left">
                                            <carousel interval="myInterval">
                                                <slide ng-repeat="photo in project.photo" active="slide.active">
                                                    <img ng-src="{{photo}}/convert?w=400&h=200" style="margin:auto;">
                                                </slide>
                                            </carousel>
                                            </div>
                                            <div style="margin-left:405px;height:200px;">
                                                <iframe width="356" height="200" src="{{project.video | trusted}}" frameborder="0" allowfullscreen></iframe>
                                            </div>
                                        </div>
                                    </div>
                                    <script type="text/ng-template" id="ProjectsModalContent.html">
                                        <div class="modal-header">
                                            <h3 class="modal-title">Edit Links</h3>
                                        </div>
                                        <div class="modal-body">
                                            <form name="projectForm">
                                                <div class="form-group" show-errors>
                                                <label style="">Project Name:</label><br>
                                                <input type="text" class="form-control" name="names" ng-model="project.name" required></input>
                                                <p class="help-block" ng-if="projectForm.names.$error.required">Please enter project name</p>
                                                </div>

                                                <div class="form-group" show-errors>
                                                <label for="academicYear">AY:</label><br>
                                                <div class="row">
                                                    <div class="col-xs-4">
                                                    <input class="form-control" placeholder="14" name="academicYear1" type="text" min="0" ng-model="project.academicYear1" ng-pattern="/^[0-9]{2}$/" required></input>
                                                    </div>
                                                
                                                    <div class="col-xs-1" style="padding: 0;">
                                                        <p class="form-control-static text-center">/</p>
                                                    </div>
                                                
                                                    <div class="col-xs-4">
                                                    <input class="form-control" placeholder="15" name="academicYear2" type="text" min="0" ng-model="project.academicYear2" ng-pattern="/^[0-9]{2}$/" required></input>
                                                    </div>
                                                </div> <!-- end of div.row -->
                                                <p class="help-block" ng-if="projectForm.academicYear1.$error.required || projectForm.academicYear2.$error.required">Please enter academic year</p>
                                                </div>

                                                <div class="form-group" show-errors>
                                                <label style="">YouTube Link:</label><br>
                                                <input http-prefix type="url" name="youtubeUrl" placeholder="http://www.youtube.com/embed/xxx" class="form-control" ng-model="project.video" ng-pattern="/^(?:https?://)?(?:www\.)?youtube\.com/embed\/([^\&\?\/]+)/" ng-disabled="disabledYouTube"></input>
                                                <label class="checkbox-inline"><input type="checkbox" ng-model="disabledYouTube">No YouTube video</label>
                                                <p class="help-block" ng-if="projectForm.$error.pattern">Please enter a valid embeded YouTube url</p>
                                            </div>

                                                <button type="button" class="btn btn-primary sharp" ng-click="uploadFile()">Upload Image</button>
                                                <p class="help-block">Please upload at least 2 images (up to 4 images)</p>
                                            </form>
                                        </div>
                                        <div class="modal-footer">
                                            <button class="btn btn-primary sharp" ng-click="save()">Save</button>
                                            <button class="btn btn-warning sharp" ng-click="cancel()">Cancel</button>
                                        </div>
                                    </script>
                                    <br ng-show="authentication.user">
                                    <button class="btn btn-primary sharp" ng-click="open()" ng-show="authentication.user">Add / Edit</button>
                                </div>
                            </div>

                            <div id="others" class="others-wrapper">
                                <div class="page-header"><h3>Others</h3></div>
                                <div ng-controller="OthersModalCtrl" class="edit">
                                    <p ng-if="content === '' && !authentication.user">"Login and start editing!</p>
                                    <p>{{content}}</p>
                                    
                                    <script type="text/ng-template" id="OthersModalContent.html">
                                        <div class="modal-header">
                                            <h3 class="modal-title">Edit Others</h3>
                                        </div>
                                        <div class="modal-body">
                                            <form>
                                            <div class="form-group">
                                                <textarea class="form-control" ng-model="content" rows="4"></textarea>
                                            </div>
                                            </form>
                                        </div>
                                        <div class="modal-footer">
                                            <button class="btn btn-primary sharp" ng-click="save()">Save</button>
                                            <button class="btn btn-warning sharp" ng-click="cancel()">Cancel</button>
                                        </div>
                                    </script>
                                    <button class="btn btn-primary sharp" ng-click="open()" ng-show="authentication.user">Edit</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">

                        <div class="content-right">
                            <div ng-controller="ModuleLogoFilePickerCtrl" class="edit">
                                <div class="thumbnail">
                                    <img src="{{img}}" alt="{{moduleTitle}} Logo">
                                </div>

                                <button type="button" class="btn btn-primary sharp" ng-click="uploadFile()" ng-show="authentication.user">Upload Image</button>
                            </div>

                            <div ng-controller="LinksModalCtrl" class="edit">
                                <div class="links row">
                                    <ul class="nav navbar-nav text-center" style="width:100%;">
                                        <li class="col-sm-6" ng-repeat="link in links">
                                            <a href="{{link.content.content}}" style="color:black;">
                                                <button class="btn btn-primary btn-lg btn-block sharp">{{link.title}}</button>
                                            </a>
                                        </li>
                                    </ul>
                                </div>

                                <script type="text/ng-template" id="LinksModalContent.html">
                                    <div class="modal-header">
                                        <h3 class="modal-title">Edit Links</h3>
                                    </div>
                                    <div class="modal-body">
                                        <form name="linksForm">
                                            <div class="form-group" show-errors>
                                                <label style="">Home:</label><br>
                                                <input http-prefix type="url" name="homepageUrl" placeholder="http://www.homepage.com" class="form-control" ng-model="links[0].content.content" ng-pattern="/^((?:http|ftp)s?:\/\/)(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+(?:[A-Z]{2,6}\.?|[A-Z0-9-]{2,}\.?)|localhost|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?::\d+)?(?:\/?|[\/?]\S+)$/i" ng-disabled="disabledHomepage" required></input>
                                                <label class="checkbox-inline"><input type="checkbox" ng-model="disabledHomepage">Check if not editing</label>
                                                <p class="help-block" ng-if="linksForm.$error.pattern">Please enter a valid url</p>
                                            </div>

                                            <div class="form-group" show-errors>
                                                <label>Facebook:</label><br>
                                                <input http-prefix type="url" name="facebookUrl" placeholder="http://www.facebook.com" class="form-control" ng-model="links[1].content.content" value="links[1].content" ng-pattern="/^((?:http|ftp)s?:\/\/)(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+(?:[A-Z]{2,6}\.?|[A-Z0-9-]{2,}\.?)|localhost|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})(?::\d+)?(?:\/?|[\/?]\S+)$/i" ng-disabled="disabledFacebook" required></input>
                                                <label class="checkbox-inline"><input type="checkbox" ng-model="disabledFacebook">Check if not editing</label>
                                                <p class="help-block" ng-if="linksForm.$error.pattern">Please enter a valid url</p>
                                            </div>

                                            <!--<div class="form-group" show-errors>
                                                <label class="radio-inline"><input type="radio" name="radio" ng-model="semester" value="1" required>Semester 1</label>
                                                <label class="radio-inline"><input type="radio" name="radio" ng-model="semester" value="2" required>Semester 2</label>
                                                <p class="help-block" ng-if="linksForm.radio.$error.required">Please select semester</p>
                                            </div>-->

                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button class="btn btn-primary sharp" ng-click="save()">Save</button>
                                        <button class="btn btn-warning sharp" ng-click="cancel()">Cancel</button>
                                    </div>
                                </script>
                                <button class="btn btn-primary sharp" ng-click="open()" ng-show="authentication.user">Edit</button>
                            </div>

                            <div class="lecturers">
                                <div class="page-header">Lecturer(s) (Semester 1):</div>
                                <span>{{module.History[0].Lecturers.toString()}}</span> 

                                <div class="page-header">Lecturer(s) (Semester 2):</div>
                                <span>{{module.History[1].Lecturers.toString()}}</span>
                            </div>
                            <div class="module-credits">
                                <div class="page-header">Module Credits:</div>
                                <span>{{module.ModuleCredit}}</span>
                            </div>
                            <div class="weekly-workload">
                                <div class="page-header">Weekly Workload:</div>
                                <span>{{module.Workload}}</span>
                            </div>
                            <div class="exam-date">
                                <div class="page-header">Exam Date (Semester 1):</div>
                                <span ng-if="module.History[0].ExamDate != null">{{module.History[0].ExamDate | date:'medium'}}</span>
                                <span ng-if="module.History[0].ExamDate == null">No exam</span>

                                <div class="page-header">Exam Date (Semester 2):</div>
                                <span ng-if="module.History[1].ExamDate != null">{{module.History[1].ExamDate | date:'medium'}}</span>
                                <span ng-if="module.History[1].ExamDate == null">No exam</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
